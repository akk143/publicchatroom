import{c as O,d as I,T as Y,a as E,o as H,q as $,b as F,w as A,g as N,e as z,f as R}from"./main-CZp6odc2.js";import{t as g,n as v,g as C,m as _,a as y,e as U,b as j}from"./en-US-8D53rcFH.js";/* empty css            */function k(r,t){let e=r,s=t;const n=O(I,"chats");let u=null;const f=async c=>{const l=new Date,h={username:s,room:e,message:c,created_at:Y.fromDate(l)};try{return await E(n,h)}catch(S){throw console.log("error addchat = ",S),S}},a=c=>{u&&u(),u=H($(n,A("room","==",e),F("created_at")),l=>{l.docChanges().forEach(h=>{h.type==="added"&&c(h.doc.data())})})},m=c=>{e=c},d=c=>{s=c,localStorage.setItem("username",s)};let i=null;return{addChat:f,getChats:a,updateChatroom:m,updateUsername:d,startDeletingMessages:()=>{i=setInterval(async()=>{try{const c=await N(n);if(c.empty){clearInterval(i);return}c.docs.forEach(async l=>{await z(R(I,"chats",l.id))})}catch(c){console.error("Error deleting messages: ",c)}},15e3)},stopDeletingMessages:()=>{i&&(clearInterval(i),i=null)}}}function x(r,t){const e=+g(r)-+g(t);return e<0?-1:e>0?1:e}function G(r,t,e){const[s,n]=v(e==null?void 0:e.in,r,t),u=s.getFullYear()-n.getFullYear(),f=s.getMonth()-n.getMonth();return u*12+f}function B(r){return t=>{const s=(r?Math[r]:Math.trunc)(t);return s===0?0:s}}function J(r,t){return+g(r)-+g(t)}function K(r,t){const e=g(r,t==null?void 0:t.in);return e.setHours(23,59,59,999),e}function P(r,t){const e=g(r,t==null?void 0:t.in),s=e.getMonth();return e.setFullYear(e.getFullYear(),s+1,0),e.setHours(23,59,59,999),e}function Q(r,t){const e=g(r,t==null?void 0:t.in);return+K(e,t)==+P(e,t)}function V(r,t,e){const[s,n,u]=v(e==null?void 0:e.in,r,r,t),f=x(n,u),a=Math.abs(G(n,u));if(a<1)return 0;n.getMonth()===1&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-f*a);let m=x(n,u)===-f;Q(s)&&a===1&&x(s,u)===1&&(m=!1);const d=f*(a-+m);return d===0?0:d}function W(r,t,e){const s=J(r,t)/1e3;return B(e==null?void 0:e.roundingMethod)(s)}function Z(r,t,e){const s=j(),n=(e==null?void 0:e.locale)??s.locale??U,u=2520,f=x(r,t);if(isNaN(f))throw new RangeError("Invalid time value");const a=Object.assign({},e,{addSuffix:e==null?void 0:e.addSuffix,comparison:f}),[m,d]=v(e==null?void 0:e.in,...f>0?[t,r]:[r,t]),i=W(d,m),T=(C(d)-C(m))/1e3,o=Math.round((i-T)/60);let c;if(o<2)return e!=null&&e.includeSeconds?i<5?n.formatDistance("lessThanXSeconds",5,a):i<10?n.formatDistance("lessThanXSeconds",10,a):i<20?n.formatDistance("lessThanXSeconds",20,a):i<40?n.formatDistance("halfAMinute",0,a):i<60?n.formatDistance("lessThanXMinutes",1,a):n.formatDistance("xMinutes",1,a):o===0?n.formatDistance("lessThanXMinutes",1,a):n.formatDistance("xMinutes",o,a);if(o<45)return n.formatDistance("xMinutes",o,a);if(o<90)return n.formatDistance("aboutXHours",1,a);if(o<_){const l=Math.round(o/60);return n.formatDistance("aboutXHours",l,a)}else{if(o<u)return n.formatDistance("xDays",1,a);if(o<y){const l=Math.round(o/_);return n.formatDistance("xDays",l,a)}else if(o<y*2)return c=Math.round(o/y),n.formatDistance("aboutXMonths",c,a)}if(c=V(d,m),c<12){const l=Math.round(o/y);return n.formatDistance("xMonths",l,a)}else{const l=c%12,h=Math.trunc(c/12);return l<3?n.formatDistance("aboutXYears",h,a):l<9?n.formatDistance("overXYears",h,a):n.formatDistance("almostXYears",h+1,a)}}function p(r){return{newli:s=>{const n=Z(s.created_at.toDate(),new Date,{addSuffix:!0}),u=`
                        <li class="shadow rounded-lg px-4 py-2">
                            <div class="flex justify-between">
                                <h5 class="text-gray-600 font-medium text-sm">${s.username}</h5>
                                <i class="text-gray-300 text-xs">${n}</i>
                            </div>
                            <p class="text-gray-600 text-sm">${s.message}</p>
                        </li>
                     `;r.innerHTML+=u},resetli:()=>{r.innerHTML=""}}}const ee=document.querySelector(".chatrooms"),te=document.querySelector(".chat-ul"),w=document.querySelector(".chat-form"),D=document.querySelector(".user-form"),X=document.querySelector(".msg"),q=document.querySelector(".roomtitle"),L=localStorage.username?localStorage.username:"Guest";D.username.placeholder=`username is ${L}`;const M=k("general",L);q.textContent="General";const b=p(te);w.addEventListener("submit",r=>{r.preventDefault();const t=w.message.value.trim();M.addChat(t).then(()=>w.reset()).catch(e=>console.log(e))});D.addEventListener("submit",r=>{r.preventDefault();const t=D.username.value.trim();M.updateUsername(t),D.reset(),X.innerText=`New name updated to ${t}`,D.username.placeholder=`username is ${t}`,setTimeout(()=>X.innerText="",3e3)});ee.addEventListener("click",r=>{r.preventDefault();const t=r.target.closest("button");if(t){b.resetli();const e=t.getAttribute("id"),s=t.querySelector("h3").innerText;q.textContent=s,M.updateChatroom(e),M.getChats(n=>{b.newli(n)})}});M.getChats(r=>{b.newli(r)});
